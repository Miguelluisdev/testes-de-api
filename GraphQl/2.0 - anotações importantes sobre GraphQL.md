# 🧠 Anotações Importantes sobre GraphQL 

Essas anotações resumem os principais conceitos e responsabilidades do QA ao trabalhar com **APIs GraphQL** — com foco em **segurança**, **performance**, **validação de dados** e **contrato de schema**.

---

## 1. GraphQL ≠ Banco de Dados

- GraphQL é uma **linguagem de consulta para APIs** e um **runtime** de execução.  
- Ele **não é um banco de dados** — funciona como uma **camada entre o cliente e as fontes de dados** (banco, microserviços, APIs REST, etc.).

🔍 **Implicação QA:**  
O QA deve compreender que o GraphQL apenas **organiza o acesso aos dados**, e não os armazena. Logo, os testes devem focar na **consistência e integridade da camada de integração**, e não apenas nos dados em si.

---

## 2. Single Endpoint

- Normalmente há **um único endpoint** (exemplo: `/graphql`), diferente do REST que possui múltiplos.  
- Todas as operações — **queries**, **mutations** e **subscriptions** — passam por ele.

🔐 **Implicação QA:**  
O foco de **segurança, autenticação e performance** está concentrado nesse único ponto de entrada.  
Testes de **rate limiting** e **acesso indevido** são essenciais.

---

## 3. Sistema de Tipos Fortes (Schema)

- O **schema** é o **coração do GraphQL**.  
  Ele define todos os tipos de dados e operações disponíveis.  
- Tipos especiais:
  - `Query`: leitura de dados.
  - `Mutation`: modificação de dados.
  - `Subscription`: dados em tempo real.
- `!` (**NonNull**): indica que um campo **nunca pode ser nulo**.

🧩 **Implicações para QA:**
- Testar se campos `NonNull` realmente **não retornam `null`**.
- Validar se os **erros são tratados corretamente** quando isso ocorre.
- O schema é o **contrato da API** — qualquer tipo ou valor fora do esperado é **bug**.
- A documentação é **gerada automaticamente** a partir do schema, sendo uma excelente referência para testes.

---

## 4. Queries (Leitura de Dados)

- Permitem que o cliente solicite **exatamente os dados necessários**.  
- Evita **over-fetching** (dados demais) e **under-fetching** (dados de menos).

🧪 **Implicação QA:**  
- Testar se a query retorna apenas os campos solicitados.  
- Remover campos e verificar se realmente não aparecem na resposta.  
- Validar tempo de resposta e estrutura dos dados.

---

## 5. Mutations (Modificação de Dados)

- Usadas para **criar, atualizar ou deletar** informações.  
- Sempre retornam o **estado atualizado** do objeto modificado.

🧪 **Implicação QA:**  
- Testar se os dados são **persistidos corretamente** após a mutation.  
- Validar se as queries subsequentes refletem as mudanças.  
- Assegurar **idempotência** onde aplicável.

---

## 6. Subscriptions (Dados em Tempo Real)

- Permitem que o cliente receba **atualizações em tempo real** via WebSocket.  
  Exemplo: notificações, chats, dashboards dinâmicos.

🧪 **Implicação QA:**  
- Testar **latência** e **consistência** das mensagens.  
- Verificar **assinaturas múltiplas** e **cancelamentos** de subscription.  
- Simular desconexões e reconexões do cliente.

---

## 7. Resolvers

- São **funções backend** que resolvem os campos definidos no schema.  
- Cada campo em GraphQL é processado por um resolver.

⚙️ **Implicação QA:**  
- Resolvers são pontos críticos para **segurança** e **performance**.  
- Testar se estão **respeitando regras de acesso** e **autorização**.  
- O **problema N+1** costuma surgir aqui — o uso de **DataLoader** é uma boa prática para evitar isso.

---

## 8. Segurança (Pontos Críticos para QA)

- **Autorização por Campo/Tipo:**  
  Diferentes perfis de usuário devem acessar apenas os dados permitidos.
- **Depth Limiting:**  
  Previne ataques de queries aninhadas infinitas.  
  ➤ Teste queries muito profundas.
- **Query Cost Analysis:**  
  Avalia o custo computacional de queries antes da execução.  
  ➤ Teste queries complexas e observe se são bloqueadas ou lentas.
- **Rate Limiting:**  
  Protege contra abusos e ataques de força bruta.  
- **Exposição de Dados Sensíveis:**  
  Garanta que o schema não exponha informações confidenciais.

🔐 **Implicação QA:**  
Esses testes ajudam a garantir que o GraphQL **não se torne um ponto único de falha ou vazamento de dados**.

---

## 9. Performance (Pontos Críticos para QA)

- **Problema N+1:**  
  Um dos maiores gargalos de performance em GraphQL.  
  ➤ QA deve identificar queries que disparam múltiplas consultas ao banco.  
  ➤ Verificar o uso de **DataLoader** ou cache.
- **Queries Complexas/Lentas:**  
  ➤ Realizar **testes de carga e stress**.  
- **Cache:**  
  Avaliar **cache do cliente (Apollo, Relay)** e **do servidor**.  
- **Monitoramento:**  
  Indispensável para observar **tempo de execução dos resolvers** em produção.

---

## 10. Tratamento de Erros

- Em GraphQL, os erros são retornados no campo `"errors"` da resposta.  
- Mesmo assim, o **HTTP status pode ser 200 OK**.

🧪 **Implicação QA:**  
- Verificar o conteúdo do campo `"errors"`.  
- As mensagens devem ser **claras**, mas **sem expor informações internas** (stack trace, SQL, etc.).  
- Testar casos de falha em autenticação, autorização e validação de dados.

---

## 11. Ferramentas Essenciais para QA

| Categoria | Ferramenta | Finalidade |
|------------|-------------|------------|
| **IDE Interativa** | GraphiQL / GraphQL Playground | Explorar schema, queries e mutations |
| **Testes de API** | Postman / Insomnia | Automação de requisições GraphQL |
| **DevTools** | Apollo Client DevTools | Depurar queries, cache e mutations |
| **Testes de Carga** | K6 / JMeter / Artillery | Testar performance sob alto volume |

---

## 🧩 Conclusão para QA

A flexibilidade do GraphQL é uma **faca de dois gumes**:  
É **poderosa** para o cliente, mas exige **maior vigilância em segurança e performance** do servidor.

🎯 **O QA deve focar em:**
- Validar o **contrato do schema** e sua tipagem.  
- Garantir **autorização correta** e **limitação de profundidade**.  
- Monitorar **performance dos resolvers**.  
- Trabalhar junto com os devs para entender **lógica de negócio e resoluções de dados**.

> “Conhecer o schema é conhecer a alma da API.  
> O QA que entende o schema testa com propósito e garante qualidade de ponta a ponta.”
